{% extends "base.html" %}

{% block title %}Recommendations - YatraNepal{% endblock %}

{% block content %}
<div class="container mt-5 pt-5">
    <div class="row">
        <div class="col-12">
            <h1 class="section-title" data-aos="fade-up">Personalized Recommendations</h1>
            <p class="text-center text-muted mb-5" data-aos="fade-up" data-aos-delay="100">
                Discover amazing places tailored just for you
            </p>
        </div>
    </div>
    
    <!-- User Profile Summary -->
    {% if user_profile %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-light" data-aos="fade-up" data-aos-delay="150">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-user-cog me-2 text-primary"></i>Your Travel Profile
                    </h5>
                    <div class="row">
                        <div class="col-md-3">
                            <small class="text-muted">Preferred Locations:</small><br>
                            <strong>{{ user_profile.preferred_locations|unique|list|length }} locations</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Price Range:</small><br>
                            <strong>NPR {{ "%.0f"|format(user_profile.preferred_price_ranges|sum / user_profile.preferred_price_ranges|length) if user_profile.preferred_price_ranges else 0 }}</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Tour Durations:</small><br>
                            <strong>{{ user_profile.preferred_durations|unique|list|length }} types</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Average Rating:</small><br>
                            <strong>{{ "%.1f"|format(user_profile.rating_preferences|sum / user_profile.rating_preferences|length) if user_profile.rating_preferences else 0 }}/5</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Currency Selector -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="currency-selector d-inline-block" data-aos="fade-up" data-aos-delay="200">
                <span class="me-3 fw-bold">Currency:</span>
                <button class="currency-btn active" data-currency="NPR">NPR</button>
                <button class="currency-btn" data-currency="USD">$</button>
            </div>
        </div>
    </div>
    
    <!-- Recommended Hotels -->
    {% if hotels %}
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="mb-4" data-aos="fade-up" data-aos-delay="300">
                <i class="fas fa-bed me-2 text-primary"></i>Recommended Hotels
            </h3>
        </div>
        {% for hotel in hotels %}
        <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 + 300 }}">
            <div class="card h-100 recommendation-card">
                <div class="position-relative">
                    <img src="{{ hotel.image_url or 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' }}" 
                         class="card-img-top" alt="{{ hotel.name }}">
                    <div class="position-absolute top-0 start-0 m-2">
                        <span class="badge bg-primary">
                            <i class="fas fa-star me-1"></i>Recommended
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ hotel.name }}</h5>
                    <p class="card-text text-muted">
                        <i class="fas fa-map-marker-alt me-2"></i>{{ hotel.location }}
                    </p>
                    <p class="card-text">{{ hotel.description[:100] }}...</p>
                    
                    <div class="rating mb-3">
                        {% for i in range(5) %}
                            <i class="fas fa-star{% if i < hotel.rating|int %}{% else %}-o{% endif %}"></i>
                        {% endfor %}
                        <span class="ms-2">{{ hotel.rating }}/5</span>
                    </div>
                    
                    {% if hotel.amenities %}
                    <div class="amenities mb-3">
                        <small class="text-muted">
                            <i class="fas fa-concierge-bell me-2"></i>
                            {{ hotel.amenities.split(',')[:3]|join(', ') }}
                            {% if hotel.amenities.split(',')|length > 3 %}...{% endif %}
                        </small>
                    </div>
                    {% endif %}
                    
                    <div class="price mb-3">
                        <span class="price-display" data-currency="NPR">
                            <strong>NPR {{ "%.0f"|format(hotel.price_nrp) }}</strong> / night
                        </span>
                        <span class="price-display" data-currency="USD" style="display: none;">
                            <strong>${{ "%.0f"|format(hotel.price_usd) }}</strong> / night
                        </span>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('hotel_detail', hotel_id=hotel.id) }}" class="btn btn-outline-primary">
                            <i class="fas fa-info-circle me-2"></i>View Details
                        </a>
                        <a href="{{ url_for('book', type='hotel', item_id=hotel.id) }}" class="btn btn-primary">
                            <i class="fas fa-calendar-check me-2"></i>Book Now
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Recommended Tours -->
    {% if tours %}
    <div class="row">
        <div class="col-12">
            <h3 class="mb-4" data-aos="fade-up" data-aos-delay="400">
                <i class="fas fa-map-marked-alt me-2 text-success"></i>Recommended Tour Packages
            </h3>
        </div>
        {% for tour in tours %}
        <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 + 400 }}">
            <div class="card h-100 recommendation-card">
                <div class="position-relative">
                    <img src="{{ tour.image_url or 'https://images.unsplash.com/photo-1552733407-5d5c46c3bb3b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' }}" 
                         class="card-img-top" alt="{{ tour.name }}">
                    <div class="position-absolute top-0 start-0 m-2">
                        <span class="badge bg-success">
                            <i class="fas fa-star me-1"></i>Recommended
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ tour.name }}</h5>
                    <p class="card-text text-muted">
                        <i class="fas fa-clock me-2"></i>{{ tour.duration }}
                    </p>
                    <p class="card-text">{{ tour.description[:100] }}...</p>
                    
                    <div class="rating mb-3">
                        {% for i in range(5) %}
                            <i class="fas fa-star{% if i < tour.rating|int %}{% else %}-o{% endif %}"></i>
                        {% endfor %}
                        <span class="ms-2">{{ tour.rating }}/5</span>
                    </div>
                    
                    {% if tour.destinations %}
                    <div class="destinations mb-3">
                        <small class="text-muted">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            {{ tour.destinations.split(',')[:3]|join(', ') }}
                            {% if tour.destinations.split(',')|length > 3 %}...{% endif %}
                        </small>
                    </div>
                    {% endif %}
                    
                    <div class="price mb-3">
                        <span class="price-display" data-currency="NPR">
                            <strong>NPR {{ "%.0f"|format(tour.price_nrp) }}</strong>
                        </span>
                        <span class="price-display" data-currency="USD" style="display: none;">
                            <strong>${{ "%.0f"|format(tour.price_usd) }}</strong>
                        </span>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('tour_detail', tour_id=tour.id) }}" class="btn btn-outline-success">
                            <i class="fas fa-info-circle me-2"></i>View Details
                        </a>
                        <a href="{{ url_for('book', type='tour', item_id=tour.id) }}" class="btn btn-success">
                            <i class="fas fa-calendar-check me-2"></i>Book Now
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- No Recommendations -->
    {% if not hotels and not tours %}
    <div class="row">
        <div class="col-12">
            <div class="card text-center" data-aos="fade-up">
                <div class="card-body py-5">
                    <i class="fas fa-lightbulb fa-3x text-muted mb-3"></i>
                    <h4>No Recommendations Yet</h4>
                    <p class="text-muted">Start exploring and booking to get personalized recommendations!</p>
                    <div class="mt-4">
                        <a href="{{ url_for('hotels') }}" class="btn btn-primary me-3">
                            <i class="fas fa-bed me-2"></i>Browse Hotels
                        </a>
                        <a href="{{ url_for('tours') }}" class="btn btn-success">
                            <i class="fas fa-map-marked-alt me-2"></i>Explore Tours
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<style>
    .recommendation-card {
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .recommendation-card:hover {
        transform: translateY(-10px);
        border-color: var(--primary-color);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }
    
    .recommendation-card .badge {
        font-size: 0.8rem;
        padding: 0.5rem 0.8rem;
    }
</style>

<script>
    // Currency switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const currencyBtns = document.querySelectorAll('.currency-btn');
        
        currencyBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                currencyBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const currency = this.dataset.currency;
                const priceElements = document.querySelectorAll(`[data-currency="${currency}"]`);
                
                document.querySelectorAll('.price-display').forEach(el => el.style.display = 'none');
                priceElements.forEach(el => el.style.display = 'block');
            });
        });
    });
</script>
{% endblock %}